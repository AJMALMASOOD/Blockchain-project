import React, { useState, useEffect } from "react";
import { ethers } from "ethers";
import contract from "./utils/contract";

function App() {
  const [donation, setDonation] = useState("");
  const [balance, setBalance] = useState("0");

  const donate = async () => {
    if (!window.ethereum) return alert("Install MetaMask!");

    const provider = new ethers.BrowserProvider(window.ethereum);
    const signer = await provider.getSigner();
    const donationContract = new ethers.Contract(contract.address, contract.abi, signer);

    const tx = await donationContract.donate({ value: ethers.parseEther(donation) });
    await tx.wait();
    loadBalance();
  };

  const loadBalance = async () => {
    const provider = new ethers.BrowserProvider(window.ethereum);
    const donationContract = new ethers.Contract(contract.address, contract.abi, provider);
    const bal = await donationContract.getBalance();
    setBalance(ethers.formatEther(bal));
  };

  useEffect(() => {
    loadBalance();
  }, []);

  return (
    <div>
      <h1>Charity Donation Tracker</h1>
      <p>Total Balance: {balance} ETH</p>
      <input
        type="text"
        placeholder="Enter amount in ETH"
        value={donation}
        onChange={(e) => setDonation(e.target.value)}
      />
      <button onClick={donate}>Donate</button>
    </div>
  );
}

export default App;
